Dropzone.autoDiscover=!1,jQuery(function(a){var b=!1;a.fn.wpcm_disable=function(){return b=!0,this.find("#wpcm-submit").addClass("wpcm-disabled").val(wpcm.lbl_submitting),this},a.fn.wpcm_enable=function(){return b=!1,this.find("#wpcm-submit").removeAttr("disabled").removeClass("wpcm-disabled"),this},a.fn.wpcm_check_required=function(){var b=!0;return this.find(".wpcm-error").removeClass("wpcm-error"),a.each(this.find(".wpcm-required-field input, .wpcm-required-field textarea, .wpcm-required-field select"),function(c,d){""!=a(d).val()&&0!=a(d).val()||(a(d).parent().addClass("wpcm-error"),b=!1)}),b},a.fn.wpcm_update_models=function(){var a=this.find("#make option:selected").val(),b=this.find("#model");if(a>0){var c={nonce:wpcm.nonce_models,make:a};jQuery.get(wpcm.ajax_url_get_models,c,function(a){if(b.attr("disabled",!1).find("option").remove(),void 0!=a&&""!=a&&0!=a&&a.length>0){b.append(jQuery("<option>").val(0).html(b.data("placeholder")));for(var c=0;c<a.length;c++)b.append(jQuery("<option>").val(a[c].id).html(a[c].name))}else b.append(jQuery("<option>").val(0).html(wpcm.lbl_no_models_found));b.select2()})}else b.attr("disabled",!0).find("option").remove().end().append(jQuery("<option>").val(0).html(wpcm.lbl_select_make_first)).select2();return this};var c=a("#wpcm-car-form");a(".wpcm-input-date").datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0}),c.find("#make").select2(),c.find("#model").select2(),c.find("#make").change(function(){c.wpcm_update_models()}),c.find("#wpcm-submit").click(function(){c.submit()}),a("div#wpcm-car-submission-images").dropzone({url:wpcm.ajax_url_post_images,paramName:"wpcm_images",autoProcessQueue:!1,addRemoveLinks:!0,uploadMultiple:!0,parallelUploads:20,maxFiles:20,acceptedFiles:"image/*",wpcm_response:null,init:function(){var a=this;c.on("wpcm_car_saved",function(b,d){a.wpcm_response=d,a.getQueuedFiles().length>0?(a.options.url=wpcm.ajax_url_post_images+"&vehicle="+a.wpcm_response.vehicle,a.processQueue()):c.trigger("wpcm_image_queue_complete",[a.wpcm_response])}),this.on("queuecomplete",function(){c.trigger("wpcm_image_queue_complete",[a.wpcm_response])})}}),c.bind("wpcm_image_queue_complete",function(a,b){window.location=c.attr("action")+"&wpcm_vehicle_id="+b.vehicle}),c.find(".wpcm-form-images-current a.wpcm-delete-image").click(function(){var b=a(this),d=b.closest("li");b.blur(),d.append(a("<div>").addClass("wpcm-image-delete-overlay")).append(a("<div>").addClass("wpcm-spinner")),jQuery.post(wpcm.ajax_url_delete_image,{nonce:wpcm.nonce_delete_image,vehicle:c.data("vehicle"),image:b.data("id")},function(b){b.success?d.fadeOut("normal",function(){a(this).remove()}):(alert("Something went wrong while trying to delete the image."),d.find(".wpcm-image-delete-overlay").remove(),d.find(".wpcm-spinner").remove())})}),c.submit(function(){if(b)return!1;if(c.wpcm_disable(),!c.wpcm_check_required())return c.wpcm_enable(),!1;var d={nonce:wpcm.nonce_save,vehicle_id:c.data("vehicle"),data:c.serialize()};return jQuery.post(wpcm.ajax_url_save,d,function(d){if(d.success)c.trigger("wpcm_car_saved",[d]);else{if(d.errors.length>0)for(var e=0;e<d.errors.length;e++){var f=a("#"+d.errors[e].id);f&&(a(f).addClass("wpcm-error"),a(f).parent().append(a("<span>").addClass("wpcm-error-desc").html(d.errors[e].msg)))}b=!1}}),!1})});